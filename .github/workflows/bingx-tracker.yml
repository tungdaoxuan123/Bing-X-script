name: BingX Portfolio Tracker (Every 10 min)

on:
  schedule:
    - cron: '*/60 * * * *'  # Run every 10 minutes
  workflow_dispatch:  # Allow manual trigger

jobs:
  track-portfolio:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Create google credentials file
      env:
        GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
      run: |
        echo "$GOOGLE_CREDENTIALS" > google_credentials.json
    
    - name: Create BingX API key file
      env:
        BINGX_API_KEY: ${{ secrets.BINGX_API_KEY }}
        BINGX_API_SECRET: ${{ secrets.BINGX_API_SECRET }}
      run: |
        python3 << 'EOF'
        import json
        api_data = {
            "api_key": "${{ secrets.BINGX_API_KEY }}",
            "api_secret": "${{ secrets.BINGX_API_SECRET }}"
        }
        with open('api_key.json', 'w') as f:
            json.dump(api_data, f)
        EOF
    
    - name: Run BingX tracker
      env:
        GOOGLE_SHEET_ID: ${{ secrets.GOOGLE_SHEET_ID }}
        BINGX_API_KEY: ${{ secrets.BINGX_API_KEY }}
        BINGX_API_SECRET: ${{ secrets.BINGX_API_SECRET }}
        GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
      run: |
        python3 bingx_to_sheets.py
    
    - name: Notify on failure
      if: failure()
      run: |
        echo "âŒ BingX tracker failed - check logs above"
